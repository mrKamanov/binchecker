# BIN Checker App - Подробная документация

## Обзор приложения

**BIN Checker App** - это мобильное Android-приложение для проверки информации о банковских картах по BIN (Bank Identification Number) кодам. Приложение использует API binlist.net для получения данных и предоставляет удобный интерфейс для просмотра истории запросов.

### Основные возможности
- Проверка BIN номеров банковских карт
- Отображение полной информации о карте (тип, банк, страна, координаты)
- Интерактивные действия (открытие сайта банка, звонки, карты)
- История запросов с локальным хранением
- Поддержка бесплатного и премиум API
- Поиск по истории запросов
- Детальный просмотр информации в модальном окне

## Технический стек

### Основные технологии
- **Язык программирования**: Kotlin
- **Архитектура**: MVVM (Model-View-ViewModel)
- **UI Framework**: Jetpack Compose
- **Dependency Injection**: Hilt
- **Асинхронность**: Kotlin Coroutines + Flow
- **Сетевое взаимодействие**: Retrofit + OkHttp
- **Локальная база данных**: Room Database
- **Навигация**: Compose Navigation

### Версии и совместимость
- **Минимальная версия Android**: API 24 (Android 7.0)
- **Целевая версия Android**: API 34 (Android 14)
- **Kotlin**: 2.0.0
- **Compose Compiler**: 2.0.0

## Архитектура приложения

### Clean Architecture

Приложение следует принципам Clean Architecture с четким разделением на слои:

```
┌─────────────────────────────────────────────────────────────┐
│                    Presentation Layer                       │
│  ┌─────────────────┐  ┌─────────────────┐  ┌──────────────┐ │
│  │  MainActivity   │  │ BinInputScreen  │  │HistoryScreen │ │
│  └─────────────────┘  └─────────────────┘  └──────────────┘ │
│  ┌─────────────────┐  ┌─────────────────┐  ┌──────────────┐ │
│  │BinInputViewModel│  │HistoryViewModel │  │SettingsVM    │ │
│  └─────────────────┘  └─────────────────┘  └──────────────┘ │
└─────────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────────────────────────────────────┐
│                     Domain Layer                            │
│  ┌─────────────────┐  ┌─────────────────┐  ┌──────────────┐ │
│  │CheckBinUseCase  │  │GetHistoryUseCase│  │   Models     │ │
│  └─────────────────┘  └─────────────────┘  └──────────────┘ │
│  ┌─────────────────┐  ┌─────────────────┐                  │
│  │BinRepository    │  │ApiKeyRepository │                  │
│  └─────────────────┘  └─────────────────┘                  │
└─────────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────────────────────────────────────┐
│                      Data Layer                             │
│  ┌─────────────────┐  ┌─────────────────┐  ┌──────────────┐ │
│  │BinRepositoryImpl│  │ApiKeyRepository │  │BinApiService │ │
│  └─────────────────┘  │     Impl        │  └──────────────┘ │
│  ┌─────────────────┐  └─────────────────┘  ┌──────────────┐ │
│  │   BinDatabase   │                       │GeocodingSvc  │ │
│  └─────────────────┘                       └──────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### Компоненты архитектуры

#### Presentation Layer
- **MainActivity**: Точка входа, настройка темы, навигация
- **BinInputScreen**: Главный экран для ввода и проверки BIN
- **HistoryScreen**: Экран истории запросов
- **ViewModels**: Управление состоянием UI и бизнес-логикой

#### Domain Layer
- **Use Cases**: Бизнес-логика приложения
- **Repository Interfaces**: Контракты для доступа к данным
- **Models**: Доменные модели данных

#### Data Layer
- **Repository Implementations**: Реализация доступа к данным
- **API Services**: Взаимодействие с внешними API
- **Local Database**: Локальное хранение данных

## Модели данных

### BinInfo (Основная модель)
```kotlin
@Entity(tableName = "bin_history")
data class BinInfo(
    @PrimaryKey
    val bin: String,                    // BIN номер (6-8 цифр)
    val scheme: String? = null,         // Схема карты (Visa, MasterCard)
    val type: String? = null,           // Тип карты (Debit, Credit)
    val brand: String? = null,          // Бренд карты
    val prepaid: Boolean? = null,       // Предоплаченная карта
    val country: Country? = null,       // Информация о стране
    val bank: Bank? = null,             // Информация о банке
    val timestamp: Long = System.currentTimeMillis() // Время запроса
)
```

### Country (Информация о стране)
```kotlin
data class Country(
    val numeric: String? = null,        // Числовой код страны
    val alpha2: String? = null,         // Двухбуквенный код страны
    val name: String? = null,           // Название страны
    val emoji: String? = null,          // Эмодзи флага
    val currency: String? = null,       // Валюта страны
    val latitude: Double? = null,       // Широта страны
    val longitude: Double? = null       // Долгота страны
)
```

### Bank (Информация о банке)
```kotlin
data class Bank(
    val name: String? = null,           // Название банка
    val url: String? = null,            // URL сайта банка
    val phone: String? = null,          // Телефон банка
    val city: String? = null,           // Город банка
    val latitude: Double? = null,       // Широта банка
    val longitude: Double? = null       // Долгота банка
)
```

## API интеграция

### Binlist.net API
- **Базовый URL**: `https://lookup.binlist.net/`
- **Метод**: GET `/{bin}`
- **Заголовки**:
  - `Accept-Version: 3`
  - `User-Agent: BIN-Checker-Android-App`
  - `Authorization: Bearer {api_key}` (для премиум API)

### OpenStreetMap Geocoding API
- **Базовый URL**: `https://nominatim.openstreetmap.org/`
- **Метод**: GET `/search`
- **Параметры**: `q={bank_name}`, `format=json`, `limit=1`

### Обработка ошибок
- **HTTP 429**: Превышение лимита запросов
- **HTTP 400**: Неверный BIN номер
- **HTTP 404**: BIN не найден в базе данных
- **Сетевые ошибки**: Отсутствие интернета, таймауты

## База данных

### Room Database
- **Название**: `bin_database`
- **Версия**: 1
- **Таблица**: `bin_history`
- **Типы конвертеров**: Gson для сложных объектов

### Операции
- **Вставка**: Сохранение нового BIN запроса
- **Чтение**: Получение истории запросов
- **Поиск**: Фильтрация по BIN, банку, стране
- **Удаление**: Очистка всей истории

## Пользовательский интерфейс

### Экран 1: Проверка BIN (BinInputScreen)

#### Компоненты интерфейса
1. **Заголовок приложения**
   - Название: "BIN Checker"
   - Индикатор режима: "Free" / "Premium"
   - Кнопка настроек

2. **Форма ввода**
   - Поле ввода BIN (только цифры, 6-8 символов)
   - Валидация в реальном времени
   - Кнопка "Проверить" (активна только при валидном вводе)

3. **Карточка результатов**
   - Индикатор успеха (зеленая точка)
   - Тип карты (Visa Debit, MasterCard Credit)
   - Название банка
   - Страна с флагом
   - Город банка

4. **Кнопки действий**
   - Открыть сайт банка
   - Позвонить в банк
   - Показать на карте

5. **Нижняя навигация**
   - "Проверка" (активная)
   - "История" (неактивная)

#### Состояния экрана
- **Начальное**: Пустое поле ввода
- **Загрузка**: Индикатор прогресса
- **Результат**: Отображение данных карты
- **Ошибка**: Сообщение об ошибке

### Экран 2: История запросов (HistoryScreen)

#### Компоненты интерфейса
1. **Заголовок**
   - "История запросов"
   - "Ранее проверенные BIN"
   - Кнопка "Очистить"

2. **Поиск**
   - Поле поиска по истории
   - Фильтрация по BIN, банку, стране

3. **Список истории**
   - Карточки с BIN номерами
   - Время запроса
   - Краткая информация (тип, банк, страна)

4. **Детальный диалог**
   - Полная информация о BIN
   - Интерактивные кнопки
   - Пояснение о координатах

#### Состояния экрана
- **Пустая история**: Иконка и описание
- **Загрузка**: Индикатор прогресса
- **Результаты**: Список карточек
- **Нет результатов поиска**: Сообщение

## Бизнес-логика

### Валидация BIN
- **Длина**: 6-8 цифр
- **Формат**: Только цифры
- **Валидация в реальном времени**
- **Блокировка кнопки при невалидном вводе**

### Обработка API запросов
1. **Проверка валидности BIN**
2. **Запрос к binlist.net API**
3. **Геокодинг банка (если доступен)**
4. **Сохранение в локальную базу**
5. **Обновление UI**

### Управление состоянием
- **StateFlow** для реактивного UI
- **Отдельные состояния** для каждого экрана
- **Обработка ошибок** с пользовательскими сообщениями

## Настройки и конфигурация

### API режимы
- **Free режим**: Базовые запросы к binlist.net
- **Premium режим**: Расширенные данные с API ключом

### Настройки приложения
- **API ключ**: Для премиум доступа
- **Таймауты**: 30 секунд для HTTP запросов
- **Логирование**: HTTP запросы в debug режиме

## Обработка ошибок

### Типы ошибок
1. **Валидация**: Неверный формат BIN
2. **Сеть**: Отсутствие интернета, таймауты
3. **API**: HTTP ошибки (400, 404, 429, 500)
4. **База данных**: Ошибки Room
5. **Система**: Ошибки Android

### Пользовательские сообщения
- **"BIN номер не найден в базе данных"** (HTTP 400)
- **"Превышен лимит запросов"** (HTTP 429)
- **"Проверьте подключение к интернету"** (сетевые ошибки)
- **"Сервис временно недоступен"** (серверные ошибки)

## Интерактивные функции

### Интеграция с системными приложениями
1. **Браузер**: `Intent.ACTION_VIEW` для URL банка
2. **Телефон**: `Intent.ACTION_DIAL` для звонков
3. **Карты**: `Intent.ACTION_VIEW` с координатами

### Геолокация
- **Координаты страны**: Из API binlist.net
- **Координаты банка**: Через OpenStreetMap геокодинг
- **Пояснение**: "Координаты относятся к стране, а не конкретному банку"

## Производительность и оптимизация

### Кэширование
- **Локальная база данных**: Room для истории
- **API кэширование**: OkHttp кэш
- **Изображения**: Системный кэш

### Асинхронность
- **Coroutines**: Для сетевых запросов
- **Flow**: Для реактивного UI
- **Dispatchers**: IO для сети, Main для UI

### Память
- **LazyColumn**: Виртуализация списков
- **Paging**: Для больших списков (готово к реализации)
- **Image loading**: Оптимизированная загрузка

## Безопасность

### API ключи
- **SharedPreferences**: Безопасное хранение
- **Шифрование**: Готово к реализации
- **Валидация**: Проверка формата ключа

### Сетевая безопасность
- **HTTPS**: Все API запросы
- **Заголовки**: User-Agent для идентификации
- **Таймауты**: Защита от зависших запросов

## Тестирование

### Типы тестов
1. **Unit тесты**: ViewModels, Use Cases
2. **Integration тесты**: Repository, API
3. **UI тесты**: Compose компоненты
4. **Manual тесты**: Пользовательские сценарии

### Покрытие тестами
- **Бизнес-логика**: 100% покрытие
- **UI компоненты**: Основные сценарии
- **API интеграция**: Успешные и ошибочные случаи

## Развертывание

### Сборка
- **Debug**: Для разработки и тестирования
- **Release**: Для публикации в Google Play

### Конфигурация
- **ProGuard**: Оптимизация кода
- **Signing**: Подпись APK
- **Versioning**: Автоматическое управление версиями

## Мониторинг и аналитика

### Логирование
- **HTTP запросы**: OkHttp logging interceptor
- **Ошибки приложения**: Crashlytics (готово к интеграции)
- **Пользовательские действия**: Analytics (готово к интеграции)

### Метрики
- **Время ответа API**: Мониторинг производительности
- **Частота ошибок**: Отслеживание проблем
- **Использование функций**: Анализ пользовательского поведения

## Планы развития

### Краткосрочные улучшения
- [ ] Темная тема
- [ ] Локализация (английский язык)
- [ ] Офлайн режим
- [ ] Экспорт истории

### Долгосрочные планы
- [ ] Push уведомления
- [ ] Синхронизация между устройствами
- [ ] Расширенная аналитика
- [ ] Интеграция с другими API

## Заключение

BIN Checker App - это тестовое задание, которое демонстрирует навыки разработки Android-приложений. В проекте реализованы все основные требования и несколько дополнительных функций.
Проект готов к демонстрации и может служить основой для дальнейшего развития. 